<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Owner Dashboard â€” TanTan</title>
  <link rel="stylesheet" href="dashboard.css?v=7" />
</head>
<body>

  <!-- â”€â”€ Login Screen â”€â”€ -->
  <div id="dash-login">
    <div class="login-box">
      <div class="login-logo">Tan<em>Tan</em></div>
      <p class="login-subtitle">Owner Dashboard<br>Private access only â€” do not share this link.</p>
      <label class="login-label" for="dash-password">Password</label>
      <input type="password" id="dash-password" placeholder="Enter your password" />
      <button class="login-btn" id="dash-login-btn">Access Dashboard â†’</button>
      <p class="login-error" id="login-error"></p>
    </div>
  </div>

  <!-- â”€â”€ Dashboard App â”€â”€ -->
  <div id="dash-app" style="display:none">

    <!-- Header -->
    <header class="dash-header">
      <div>
        <span class="dash-header-logo">Tan<em>Tan</em></span>
        <span class="dash-header-tag">Owner</span>
      </div>
      <div class="dash-header-right">
        <span class="dash-owner-label">Private Dashboard</span>
        <button class="dash-logout-btn" id="dash-logout">Log Out</button>
      </div>
    </header>

    <!-- Tab Navigation -->
    <nav class="dash-tabs">
      <button class="dash-tab-btn active" data-tab="stock">ğŸ“¦ Stock</button>
      <button class="dash-tab-btn" data-tab="orders">ğŸ§¾ Orders</button>
      <button class="dash-tab-btn" data-tab="customers">ğŸ‘¥ Customers</button>
      <button class="dash-tab-btn" data-tab="pl">ğŸ’° P&amp;L</button>
      <button class="dash-tab-btn" data-tab="products">ğŸ·ï¸ Products</button>
      <button class="dash-tab-btn" data-tab="popular">ğŸ“Š Popular</button>
      <button class="dash-tab-btn" data-tab="security">ğŸ›¡ï¸ Security</button>
    </nav>

    <!-- â”€â”€ Stock Panel â”€â”€ -->
    <div class="dash-panel active" id="panel-stock">
      <div class="dash-section-header">
        <h2>ğŸ“¦ Stock Management</h2>
        <button class="save-all-btn" id="save-all-stock">ğŸ’¾ Save All Changes</button>
      </div>
      <div id="low-stock-alert"></div>
      <div class="dash-table-wrap">
        <table class="dash-table">
          <thead>
            <tr>
              <th>Product</th>
              <th>Category</th>
              <th>Sale Price</th>
              <th>Cost Price (Â£)</th>
              <th>Stock Qty</th>
              <th>Status</th>
              <th>Update</th>
            </tr>
          </thead>
          <tbody id="stock-tbody"></tbody>
        </table>
      </div>
    </div>

    <!-- â”€â”€ Orders Panel â”€â”€ -->
    <div class="dash-panel" id="panel-orders">
      <div class="dash-section-header">
        <h2>ğŸ§¾ Orders</h2>
        <span id="order-count" style="font-size:0.875rem;color:var(--muted)"></span>
      </div>
      <div class="dash-table-wrap" id="orders-table-wrap">
        <table class="dash-table">
          <thead>
            <tr>
              <th>Order #</th>
              <th>Date &amp; Time</th>
              <th>Customer</th>
              <th>Items Ordered</th>
              <th>Total</th>
              <th>Payment</th>
              <th>Delivery Status</th>
            </tr>
          </thead>
          <tbody id="orders-tbody"></tbody>
        </table>
      </div>
      <div id="orders-empty" class="dash-empty" style="display:none">
        <div class="dash-empty-icon">ğŸ§¾</div>
        <h3>No orders yet</h3>
        <p>Orders placed through the website will appear here automatically.</p>
      </div>
    </div>

    <!-- â”€â”€ Customers Panel â”€â”€ -->
    <div class="dash-panel" id="panel-customers">
      <div class="dash-section-header">
        <h2>ğŸ‘¥ Customer Information</h2>
        <span id="customer-count" style="font-size:0.875rem;color:var(--muted)"></span>
      </div>
      <div class="cust-search-wrap">
        <input type="text" id="cust-search" class="cust-search-input" placeholder="ğŸ”  Search by name or emailâ€¦" />
      </div>
      <div class="dash-table-wrap" id="customers-table-wrap">
        <table class="dash-table">
          <thead>
            <tr>
              <th>Customer</th>
              <th>Delivery Address</th>
              <th>Products Ordered</th>
              <th>Orders</th>
              <th>Total Spent</th>
              <th>Last Order</th>
            </tr>
          </thead>
          <tbody id="customers-tbody"></tbody>
        </table>
      </div>
      <div id="customers-empty" class="dash-empty" style="display:none">
        <div class="dash-empty-icon">ğŸ‘¥</div>
        <h3>No customers yet</h3>
        <p>Customer details are collected automatically when orders are placed.</p>
      </div>
      <div id="customers-no-results" class="dash-empty" style="display:none">
        <div class="dash-empty-icon">ğŸ”</div>
        <h3>No results found</h3>
        <p>Try a different name or email address.</p>
      </div>
    </div>

    <!-- â”€â”€ P&L Panel â”€â”€ -->
    <div class="dash-panel" id="panel-pl">
      <div class="dash-section-header">
        <h2>ğŸ’° Profit &amp; Loss</h2>
      </div>
      <div class="pl-cards" id="pl-cards"></div>

      <p class="pl-subtitle">This Month â€” Weekly Breakdown</p>
      <div class="dash-table-wrap" style="margin-bottom:2rem">
        <table class="dash-table">
          <thead>
            <tr><th>Week</th><th>Orders</th><th>Revenue</th><th>Est. Cost</th><th>Profit</th></tr>
          </thead>
          <tbody id="pl-weekly-tbody"></tbody>
        </table>
      </div>

      <p class="pl-subtitle">Monthly Summary â€” Last 6 Months</p>
      <div class="dash-table-wrap">
        <table class="dash-table">
          <thead>
            <tr><th>Month</th><th>Orders</th><th>Revenue</th><th>Est. Cost</th><th>Profit</th></tr>
          </thead>
          <tbody id="pl-monthly-tbody"></tbody>
        </table>
      </div>
      <p style="font-size:0.78rem;color:var(--muted);margin-top:1rem">
        * Estimated cost uses the cost prices set in the Stock tab. Update those for accurate P&amp;L figures.
      </p>
    </div>

    <!-- â”€â”€ Products Panel â”€â”€ -->
    <div class="dash-panel" id="panel-products">
      <div class="dash-section-header">
        <h2>ğŸ·ï¸ Product Management</h2>
        <button class="save-all-btn" id="save-all-products">ğŸ’¾ Save All Changes</button>
      </div>
      <p style="font-size:0.82rem;color:var(--muted);margin-bottom:1.5rem">Edit product names, prices and categories below. Use <strong>Save</strong> per row or <strong>Save All Changes</strong> to update everything. Use <strong>Delete</strong> to permanently remove a product.</p>

      <!-- Category Name Editor -->
      <div class="prod-mgmt-card">
        <div class="prod-mgmt-card-title">ğŸ“‚ Edit Category Names</div>
        <p style="font-size:0.8rem;color:var(--muted);margin-bottom:1rem">Rename any category â€” changes apply on the products page immediately.</p>
        <div id="cat-names-grid"></div>
      </div>

      <!-- Add New Product -->
      <div class="prod-mgmt-card">
        <div class="prod-mgmt-card-header">
          <div class="prod-mgmt-card-title">â• Add New Product</div>
          <button class="save-all-btn" id="add-prod-toggle">ï¼‹ New Product</button>
        </div>
        <div id="add-prod-form" style="display:none;margin-top:1.25rem">
          <div class="add-prod-grid">
            <div class="add-prod-field">
              <label class="dash-field-label">Product Name *</label>
              <input type="text" id="new-prod-name" class="dash-field-input" placeholder="e.g. Mango Tanning Oil" />
            </div>
            <div class="add-prod-field">
              <label class="dash-field-label">Category *</label>
              <select id="new-prod-cat" class="prod-cat-select" style="width:100%;max-width:100%"></select>
            </div>
            <div class="add-prod-field">
              <label class="dash-field-label">Price (Â£) *</label>
              <input type="number" id="new-prod-price" class="dash-field-input" min="0" step="0.01" placeholder="0.00" />
            </div>
            <div class="add-prod-field">
              <label class="dash-field-label">Emoji</label>
              <input type="text" id="new-prod-emoji" class="dash-field-input" placeholder="âœ¨" maxlength="2" style="width:80px" />
            </div>
          </div>
          <div class="add-prod-field" style="margin-top:0.75rem">
            <label class="dash-field-label">Description *</label>
            <textarea id="new-prod-desc" class="dash-field-textarea" rows="3" placeholder="Describe this productâ€¦"></textarea>
          </div>
          <div class="add-prod-field" style="margin-top:0.75rem">
            <label class="dash-field-label">Visual Style</label>
            <select id="new-prod-grad" class="prod-cat-select" style="width:100%;max-width:220px">
              <option value="g1">Golden</option>
              <option value="gfrs">Strawberry Pink</option>
              <option value="gfro">Orange</option>
              <option value="gfrw">Watermelon</option>
              <option value="gfrc">Coconut</option>
              <option value="gspl">Light Bronze</option>
              <option value="gspm">Medium Bronze</option>
              <option value="gspd">Dark Bronze</option>
            </select>
          </div>
          <button class="save-all-btn" id="add-prod-submit" style="margin-top:1.25rem">+ Add Product</button>
          <p id="add-prod-error" style="color:var(--danger);font-size:0.82rem;margin-top:0.5rem;min-height:1.2em"></p>
        </div>
      </div>

      <div class="dash-table-wrap">
        <table class="dash-table">
          <thead>
            <tr>
              <th>Category</th>
              <th>Product Name</th>
              <th>Price (Â£)</th>
              <th>Status</th>
              <th>Action</th>
              <th></th>
            </tr>
          </thead>
          <tbody id="products-tbody"></tbody>
        </table>
      </div>
    </div>

    <!-- â”€â”€ Popular Products Panel â”€â”€ -->
    <div class="dash-panel" id="panel-popular">
      <div class="dash-section-header">
        <h2>ğŸ“Š Popular Products</h2>
        <span style="font-size:0.875rem;color:var(--muted)">Based on all orders placed</span>
      </div>
      <div id="popular-empty" class="dash-empty" style="display:none">
        <div class="dash-empty-icon">ğŸ“Š</div>
        <h3>No orders yet</h3>
        <p>Popular products will appear here once orders have been placed.</p>
      </div>
      <div id="popular-content">
        <div class="pop-grid">
          <div class="pop-card pop-card-gold">
            <div class="pop-card-title">ğŸ† Top 5 Best Sellers</div>
            <div id="pop-top5"></div>
          </div>
          <div class="pop-card pop-card-blue">
            <div class="pop-card-title">ğŸ“‰ 5 Least Ordered</div>
            <div id="pop-bot5"></div>
          </div>
        </div>
      </div>
    </div>

    <!-- â”€â”€ Security Panel â”€â”€ -->
    <div class="dash-panel" id="panel-security">
      <div class="dash-section-header">
        <h2>ğŸ›¡ï¸ Security Log</h2>
        <div style="display:flex;align-items:center;gap:1rem;flex-wrap:wrap">
          <span class="sec-live-badge">
            <span class="sec-live-dot" id="sec-live-dot"></span>
            Live
          </span>
          <span id="sec-last-checked" style="font-size:0.78rem;color:var(--muted)"></span>
          <button class="save-all-btn" id="sec-clear-btn">ğŸ—‘ï¸ Clear Log</button>
        </div>
      </div>
      <p style="font-size:0.82rem;color:var(--muted);margin-bottom:1.5rem">
        Blocked bot attempts detected by user-agent matching on the landing page. Polls every 3 seconds â€” new rows flash amber. Only JS-executing bots are captured here.
      </p>
      <div id="sec-summary" style="display:flex;gap:1rem;flex-wrap:wrap;margin-bottom:1.5rem"></div>
      <div class="dash-table-wrap" id="sec-table-wrap">
        <table class="dash-table">
          <thead>
            <tr>
              <th>#</th>
              <th>Date &amp; Time</th>
              <th>Page</th>
              <th>Reason</th>
              <th>User Agent</th>
            </tr>
          </thead>
          <tbody id="sec-tbody"></tbody>
        </table>
      </div>
      <div id="sec-empty" class="dash-empty" style="display:none">
        <div class="dash-empty-icon">ğŸ›¡ï¸</div>
        <h3>No blocked attempts yet</h3>
        <p>When a bot matching a blocked user-agent visits the landing page, it will be logged here.</p>
      </div>
    </div>

  </div><!-- /#dash-app -->

  <script src="script.js?v=36"></script>
  <!-- Core shared utilities â€” loaded first -->
  <script src="dashboard.js?v=11"></script>
  <!-- Section files â€” one per tab, safe to edit independently -->
  <script src="dashboard-stock.js?v=1"></script>
  <script src="dashboard-orders.js?v=1"></script>
  <script src="dashboard-customers.js?v=1"></script>
  <script src="dashboard-pl.js?v=1"></script>
  <script src="dashboard-products.js?v=1"></script>
  <script src="dashboard-popular.js?v=1"></script>
  <script src="dashboard-security.js?v=2"></script>
  <!-- Login / init â€” loaded last so all sections are defined -->
  <script src="dashboard-login.js?v=1"></script>
</body>
</html>
